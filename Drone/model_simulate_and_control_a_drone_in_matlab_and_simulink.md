# Model, Simulate and Control a Drone in Matlab and Simulink #

## Section 1: Mathematical and Physical Modelling #
### DJI Mavic Pro Design Brief ###
1. Objective of the course
	1. Establish mathematical model and physics behind four propeller drone modelled after DJI Mavic Pro
	2. Design a SIMULINK model simulating the complete dynamics of drone as well as impact of location and gusts
	3. Design and implement a PID controller to control the position and attitude of our drone
2. Simplified version of Mavic Pro (angles and shapes are simpler) - mavic pro website
	1. Diagonal length: 335 mm
	2. Weight: 0.743 kg
	3. Frontal Area: 0.0197 m^2
	4. Motor KV: 1400 rpm/V
	5. Battery Capacity: 3830 mAh
	6. Voltage: 11.4 V
	7. Max Discharge Current: 20C/77A
	8. Propeller Size: 8 x 4 inches (diameter by pitch)
9. What are we modeling?
	1. Motor, Propellers and battery performance
		1. How they work together (to make the drone fly, to go where we want it to go, power in proportion)
	2. Drone physics and dynamics
		1. How it moves
		2. How it reacts to different forces and moments
	3. Sensors and control
		1. Act on data to control the drone
10. Forces at play
	1. Motor's thrust
	2. Drag and Gusts
	3. Gravity
	4. Motors/Propellers Torque
11. Model Diagram
	1. Input -> Controller
	2. Controller -> DC Motors
	3. DC Motors -> Propellers
	4. Battery Performance -> DC Motors
	5. Propellers -> Thrust Vector
	6. Thrust Vector -> Drone Dynamics
	7. Disturbances -> Drone Dynamics
	8. Drone Dynamics -> Position, Velocity, Acceleration, Attitude, Altitude
	9. Position, Velocity, Acceleration, Attitude, Altitude -> Controller

### Battery Specifications and Performance ###
1. It has impact on the drone
2. DJI Mavic Pro Battery
	1. Mavic Pro's battery consists in three high discharge capacity Lithium-Polymer cells mounted in series
	2. Each cell has an average capacity of 3830 mAh and nominal voltage of 3.8 V
	3. Total capacity is 43.6 Wh for a weight of 240 g
3. Battery Performance
	1. In a circuit mounted in series, voltage of circuit is sum of voltages of its components but current remains constant
	2. In a circuit mounted in parallel, voltage of circuit is same throughout but current is sum of current going through all its components mounted in parallel
	3. Nominal voltage: 

			3.8 * 3 = 11.4 V
	
	4. Max discharge capacity is 20C (staying conservative) (20 times the capacity of the battery)
	
			I = 3.830 * 20 = 77 A
			
4. Motor Limits
	1. This battery analysis gave us our max operating voltage which we will take as 11.4 V to consider an average over one battery discharge and a max current of 77 A
	2. The characteristics will allow to limit performance of motors to realistic values by limiting energy they are allowed to extract from battery
	3. The parameters will be approximately implemented in SIMULINK

### Empirical Modelling of DC Motors ###
1. DJI Mavic Pro's vs Ours
	1. Mavic Pro uses brushless DC motors
	2. This requires complex electronics and mathematics to be controlled but are highly efficient, compact and do not wear much nor require maintenance
		1. We could model them using maths behind brushed DC motors
			1. But we could use provided motor constants to look at different approach and have a simpler model overall
2. RPM Motor Constant KV
	1. RPM constant KV expressed in RPM/Volt - 1400 RPM/V is back-emf generated in motor at a certain speed
		1. It tells how much voltage the motorl generates when it rotates
			1. At a certain speed the voltage generated by motor is equal to the voltage applied to it, so there is no more acceleration
	2. Torque required from motor is proportional to square of rotational velocity of its propeller
		1. 

### Empirical Modelling of Propeller's Behaviour and Performance ###
1. Mathematical representation of model of motors of the drone
2. DJI Mavic Pro's vs Ours
	1. The Mavic Pro uses brushless DC motors
		1. New technology
		2. Requires complex electronics
		3. Efficient
		4. Does not wear much
			1. No much maintenance
	2. These require complex electronics and mathematics to be controlled but are highly efficient, compact and do not wear much nor require maintenance
	3. As we did in the "Model a Car and Design a PID Controller in MATLAB/SIMULINK" course, we could model them using the maths behind brushed DC motors.
		1. Much simpler
	4. However, we will use provided motor constants to look at a different approahc and have a simpler model overall
3. The RPM Motor Constant KV
	1. The RPM constant KV expressed in RPM/Volt, 1400 RPM/V here, tells use the back-emf generated in the motor at a certain speed
		1. RPM constant tells how much voltage the motor itself generates. The faster the motor rotates, the greater the voltage is
		2. When voltage is applied, motor generates a voltage until it's voltage is no different from the voltage applied to it
			1. Acceleration stops
		2. When there is no load, the RPM matches the RPM constant
		3. When load is applied, RPM decreases
	2. The torque required from the motor is proportional to the square of the rotational velocity of its propeller
	3. We assume a 0% RPM drop from KV at 0V and a 25% RPM drop from KV at max voltage: 11.4V
		1. 25% rotational velocity drop from the KV at max voltage
4. RPM Equation with loading assumption

		RPM = -2.6931 * V^3 + 1400 * V
		
	1. 20 sample outputs constructed in the range 0 V - 11.4 V
	2. Estimation needs to be made
		1. If propellers are attached, the percentage drop is going to increase proportionally to the square of rotational velocity
			1. When there is no load, velocity increases linearly

### Linear and Rotational Drone Dynamics ###
### Actuation: Moments and Disturbances ###
### Actuation: Thrust Vectors and Linear Forces ###

## Section 2: Creation of the Open Loop Simulink Model ##
### SIMULINK and the Motors/ Propellers Block ###
### Implementing the Rotational Dynamics Block ###
### Implementing the Linear Dynamics Block ###
### Converting Gusts to Drag Disturbances ###
### Converting Throttle and Attitude Inputs to Motor Voltage Signals ###
### Running and Debugging the Open Loop Drone Model (Direct Online ###
### 3D Motion Visualization from SIMULINK to MATLAB ###

## Closing the Loop and Implementing PID Feedback Control ##
### Automated Altitude PID Control ###
### Quadcopter PID Control ###